# XONSH WEBCONFIG START
from xonsh.tools import register_custom_style
mystyle = {
"RED": "#e74c3c",
"BLUE": "#51afef",
"CYAN": "#1abc9c",
"BLACK": "#21272e",
"GREEN":"#53df83",
"PURPLE": "#C5A3FF",
"YELLOW":"#ECBE7B",
"DEFAULT":"#f8f8f0",
"WHITE": "#f8f8f0",
"INTENSE_CYAN":"#1abc9c",
}
register_custom_style("mystyle", mystyle, base="fruity")
# $XONSH_COLOR_STYLE="inkpot"
# $XONSH_COLOR_STYLE="lovelace"
# $XONSH_COLOR_STYLE="rainbow_dash"



source-zsh "~/.zshrc"
$PROMPT = '{BOLD_RED}{user}@A.R.T 🏳️‍⚧️ {BOLD_INTENSE_RED}{cwd}{env_name: {}}{#FCF434}❯{#FFFFFF}❯{#9C59D1}❯{INTENSE_BLACK}❯{RESET}'
# $XONSH_COLOR_STYLE = 'inkpot'
$XONSH_COLOR_STYLE = 'nord-darker'
# XONSH WEBCONFIG END
$COMMANDS_CACHE_SIZE_WARNING='10000'
# XONSH WIZARD START
# setopt AUTO_CD
$AUTO_CD = True
$AUTO_PUSHD = True
$CDPATH=("$HOME/d" ,"$HOME/d/fa22", "$HOME/d/*")
$AUTO_SUGGEST = True
$AUTO_SUGGEST_IN_COMPLETIONS = '1'
$CASE_SENSITIVE_COMPLETIONS = '1'
$COLOR_INPUT = True
$COLOR_RESULTS = '1'
$COMPLETIONS_BRACKETS = '1'
$COMPLETIONS_CONFIRM = '1'
$COMPLETIONS_DISPLAY = 'multi'
$COMPLETIONS_MENU_ROWS = '5'
$COMPLETION_IN_THREAD = '1'
$COMPLETION_QUERY_LIMIT = '25'
$DIRSTACK_SIZE = '20'
$DOTGLOB = ''
$DYNAMIC_CWD_ELISION_CHAR = '...'
$EXPAND_ENV_VARS = '1'
$FOREIGN_ALIASES_OVERRIDE = ''
$FOREIGN_ALIASES_SUPPRESS_SKIP_MESSAGE = '1'
$FUZZY_PATH_COMPLETION = '1'
$GLOB_SORTED = '1'
$IGNOREEOF = ''
$INDENT = '    '
$MULTILINE_PROMPT = '..'
$PATHEXT = 'APPIMAGE'
$PRETTY_PRINT_RESULTS = '1'
#$PROMPT = '{BLUE}{cwd} $ '
$THREAD_SUBPROCS = '1'
$XONSH_AUTOPAIR = True
# $XONSH_COLOR_STYLE = "native"
# $XONSH_SHOW_TRACEBACK = True
$XONSH_HISTORY_SIZE=131072


# xontrib load coreutils whole_word_jumping z  gitinfo jedi vox autovox argcomplete django
xontrib load coreutils whole_word_jumping vox
# prompt_starship
# jedi
# xontrib load coreutils

# xontrib load powerline2

# xontrib load pyenv

# cd ~/apps/5e-srd-api && docker compose up --build -d



# XONSH WIZARD END

# if "eterm" not in $TERM:
#	 xontrib load powerline

aliases['nemohere']="nemo @($(pwd).strip()) . &"
aliases['nemosu']="sudo nemo @($(pwd).strip())"
aliases['cat']='bat'
aliases['bg']='batgrep'
aliases["newdoom"]="doom sync && systemctl restart --user emacs && e"

# import sys
# import random
# from random import randint
# fortune

# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
# if !(test -f "/home/vivien/miniconda3/bin/conda"):
#     import sys as _sys
#     from types import ModuleType as _ModuleType
#     _mod = _ModuleType("xontrib.conda",
#                     "Autogenerated from $(/home/vivien/miniconda3/bin/conda shell.xonsh hook)")
#     __xonsh__.execer.exec($("/home/vivien/miniconda3/bin/conda" "shell.xonsh" "hook"),
#                         glbs=_mod.__dict__,
#                         filename="$(/home/vivien/miniconda3/bin/conda shell.xonsh hook)")
#     _sys.modules["xontrib.conda"] = _mod
#     del _sys, _mod, _ModuleType
# # <<< conda initialize <<<
# exec($(starship init xonsh))
import uuid


def starship_prompt():
    last_cmd = __xonsh__.history[-1] if __xonsh__.history else None
    status = last_cmd.rtn if last_cmd else 0
    # I believe this is equivalent to xonsh.jobs.get_next_job_number() for our purposes,
    # but we can't use that function because of https://gitter.im/xonsh/xonsh?at=60e8832d82dd9050f5e0c96a
    jobs = sum(1 for job in __xonsh__.all_jobs.values() if job['obj'] and job['obj'].poll() is None)
    duration = round((last_cmd.ts[1] - last_cmd.ts[0]) * 1000) if last_cmd else 0
    return $(/usr/bin/starship prompt --status=@(status) --jobs=@(jobs) --cmd-duration=@(duration))

def starship_rprompt():
    last_cmd = __xonsh__.history[-1] if __xonsh__.history else None
    status = last_cmd.rtn if last_cmd else 0
    # I believe this is equivalent to xonsh.jobs.get_next_job_number() for our purposes,
    # but we can't use that function because of https://gitter.im/xonsh/xonsh?at=60e8832d82dd9050f5e0c96a
    jobs = sum(1 for job in __xonsh__.all_jobs.values() if job['obj'] and job['obj'].poll() is None)
    duration = round((last_cmd.ts[1] - last_cmd.ts[0]) * 1000) if last_cmd else 0
    return $(/usr/bin/starship prompt --status=@(status) --jobs=@(jobs) --cmd-duration=@(duration) --right)


$PROMPT = starship_prompt
$RIGHT_PROMPT = starship_rprompt
$STARSHIP_SHELL = "xonsh"
$STARSHIP_SESSION_KEY = uuid.uuid4().hex
# conda deactivate
@events.autovox_policy
def dotvenv_policy(path, **_):
    venv = path / '.venv'
    if venv.exists():
        return venv
